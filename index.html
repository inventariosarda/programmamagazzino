<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Programma Magazzino</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        background: #f2f2f2;
    }

    /* Sidebar */
    #sidebar {
        width: 260px;
        background: #fff;
        border-left: 2px solid #ccc;
        padding: 15px;
        height: 100vh;
        overflow-y: auto;
        position: fixed;
        right: 0;
        top: 0;
    }

    #sidebar h2 {
        text-align: center;
        margin-top: 0;
    }

    .worker {
        padding: 8px;
        margin: 5px 0;
        background: #e8e8e8;
        border-radius: 4px;
        cursor: grab;
        text-align: center;
    }

    .worker:active {
        cursor: grabbing;
    }

    #addWorkerBox {
        display: flex;
        margin-top: 10px;
    }

    #addWorkerBox input {
        flex: 1;
        padding: 5px;
    }

    #addWorkerBox button {
        padding: 5px 10px;
        margin-left: 5px;
        cursor: pointer;
    }

    /* Main */
    #main {
        flex: 1;
        padding: 20px;
        margin-right: 260px;
    }

    .daySelector button {
        padding: 10px 15px;
        margin-right: 5px;
        cursor: pointer;
    }

    .weekNav {
        margin: 15px 0;
    }

    .weekNav button {
        padding: 8px 12px;
        margin-right: 10px;
        cursor: pointer;
    }

    .section {
        margin-top: 25px;
        background: white;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .section h3 {
        margin: 0;
        padding: 5px 0;
        border-bottom: 1px solid #ccc;
    }

    .row {
        display: flex;
        border-bottom: 1px solid #eee;
        padding: 6px 0;
    }

    .row label {
        width: 250px;
        font-weight: bold;
    }

    .cell {
        flex: 1;
        min-height: 35px;
        background: #fafafa;
        border: 1px solid #ddd;
        padding: 5px;
        cursor: pointer;
    }

    .cell:hover {
        background: #e6f7ff;
    }
</style>
</head>

<body>

<!-- Sidebar -->
<div id="sidebar">
    <h2>Dipendenti</h2>
    <div id="workersList"></div>

    <h3>Aggiungi dipendente</h3>
    <div id="addWorkerBox">
        <input type="text" id="newWorker" placeholder="Nome">
        <button onclick="addWorker()">+</button>
    </div>
</div>

<!-- Main -->
<div id="main">

    <h1>Programma Magazzino</h1>

    <!-- Selezione giorno -->
    <div class="daySelector">
        <button onclick="selectDay('lun')">Lunedì</button>
        <button onclick="selectDay('mar')">Martedì</button>
        <button onclick="selectDay('mer')">Mercoledì</button>
        <button onclick="selectDay('gio')">Giovedì</button>
        <button onclick="selectDay('ven')">Venerdì</button>
        <button onclick="selectDay('sab')">Sabato</button>
    </div>

    <!-- Navigazione settimana -->
    <div class="weekNav">
        <button onclick="prevWeek()">← Settimana precedente</button>
        <span id="weekLabel"></span>
        <button onclick="nextWeek()">Settimana successiva →</button>
    </div>

    <!-- ESEMPIO DI REPARTO -->
    <div class="section">
        <h3>GRATTUGIATURA GRATTUGIA</h3>

        <div class="row">
            <label>06:00–14:00</label>
            <div class="cell dropcell" data-key="g1"></div>
        </div>

        <div class="row">
            <label></label>
            <div class="cell dropcell" data-key="g2"></div>
        </div>

        <div class="row">
            <label></label>
            <div class="cell dropcell" data-key="g3"></div>
        </div>

        <div class="row">
            <label></label>
            <div class="cell dropcell" data-key="g4"></div>
        </div>

        <div class="row">
            <label></label>
            <div class="cell dropcell" data-key="g5"></div>
        </div>
    </div>

</div>

<script>
/* ============================================================
   GESTIONE SETTIMANE
   ============================================================ */
let currentWeek = getCurrentWeek();
let currentDay = "lun";

function getCurrentWeek() {
    const now = new Date();
    const onejan = new Date(now.getFullYear(), 0, 1);
    return Math.ceil((((now - onejan) / 86400000) + onejan.getDay() + 1) / 7);
}

function updateWeekLabel() {
    document.getElementById("weekLabel").innerText =
        "Settimana " + currentWeek;
}

function prevWeek() {
    currentWeek--;
    loadTable();
    updateWorkersList();
    updateWeekLabel();
}

function nextWeek() {
    currentWeek++;
    loadTable();
    updateWorkersList();
    updateWeekLabel();
}

updateWeekLabel();

/* ============================================================
   SELEZIONE GIORNO
   ============================================================ */
function selectDay(day) {
    currentDay = day;
    loadTable();
    updateWorkersList();
}

/* ============================================================
   DRAG & DROP
   ============================================================ */
function allowDrop(ev) { ev.preventDefault(); }
function drag(ev) { ev.dataTransfer.setData("text", ev.target.innerText); }

document.querySelectorAll(".dropcell").forEach(cell => {
    cell.ondragover = allowDrop;
    cell.ondrop = function(ev) {
        ev.preventDefault();
        const name = ev.dataTransfer.getData("text");
        this.innerText = name;
        saveTable();
        updateWorkersList();
    };
});

/* ============================================================
   SALVATAGGIO CELLE
   ============================================================ */
function saveTable() {
    document.querySelectorAll(".dropcell").forEach(cell => {
        const key = cell.dataset.key;
        const storageKey = `${currentWeek}_${currentDay}_${key}`;
        localStorage.setItem(storageKey, cell.innerText);
    });
}

function loadTable() {
    document.querySelectorAll(".dropcell").forEach(cell => {
        const key = cell.dataset.key;
        const storageKey = `${currentWeek}_${currentDay}_${key}`;
        cell.innerText = localStorage.getItem(storageKey) || "";
    });
}

loadTable();

/* ============================================================
   DIPENDENTI
   ============================================================ */
const defaultWorkers = [
"ILIE","ARCURI","BAGHIN","LINENCO","NOCENTINI","SOTTILI","BAGIARDI","CHAND","NANNUCCI",
"BROGELLI","PELLEGRINI","MARCUCCI","DI STEFANO","RENZI","BILLI","FAGIOLI","MAGHERINI",
"GRIMALDI","PALMIERI","HRICTU","DONATI","HRISTAR","MAGNI","SACCHETTI","PINHEIRO",
"TRIVIGNO","VINCI","RICCI","RIGHESCHI","PARDEEP","FORTE","CAPPELLI","ERMINI",
"PIPPUCCI","TOZZI","BRUNORI","CECCHERINI","COLONNA","NOTTURNI","NOVELLI"
];

function updateWorkersList() {
    const list = document.getElementById("workersList");
    list.innerHTML = "";

    const assigned = new Set();
    document.querySelectorAll(".dropcell").forEach(cell => {
        if (cell.innerText.trim() !== "") assigned.add(cell.innerText.trim());
    });

    defaultWorkers.forEach(w => {
        if (!assigned.has(w)) {
            const div = document.createElement("div");
            div.className = "worker";
            div.draggable = true;
            div.ondragstart = drag;
            div.innerText = w;
            list.appendChild(div);
        }
    });
}

updateWorkersList();

/* ============================================================
   AGGIUNTA DIPENDENTE
   ============================================================ */
function addWorker() {
    const name = document.getElementById("newWorker").value.trim();
    if (name === "") return;

    defaultWorkers.push(name);
    document.getElementById("newWorker").value = "";
    updateWorkersList();
}
</script>

</body>
</html>
