<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Programma Magazzino</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        background: #f2f2f2;
    }

    /* Sidebar */
    #sidebar {
        width: 260px;
        background: #fff;
        border-left: 2px solid #ccc;
        padding: 15px;
        height: 100vh;
        overflow-y: auto;
        position: fixed;
        right: 0;
        top: 0;
    }

    #sidebar h2 {
        text-align: center;
        margin-top: 0;
    }

    .worker {
        padding: 8px;
        margin: 5px 0;
        background: #e8e8e8;
        border-radius: 4px;
        cursor: grab;
        text-align: center;
    }

    .worker:active {
        cursor: grabbing;
    }

    #addWorkerBox {
        display: flex;
        margin-top: 10px;
    }

    #addWorkerBox input {
        flex: 1;
        padding: 5px;
    }

    #addWorkerBox button {
        padding: 5px 10px;
        margin-left: 5px;
        cursor: pointer;
    }

    /* Main */
    #main {
        flex: 1;
        padding: 20px;
        margin-right: 260px;
    }

    .weekNav {
        margin: 15px 0;
    }

    .weekNav button {
        padding: 8px 12px;
        margin-right: 10px;
        cursor: pointer;
    }

    .section {
        margin-top: 25px;
        background: white;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .section h3 {
        margin: 0;
        padding: 5px 0;
        border-bottom: 1px solid #ccc;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: center;
    }

    th {
        background: #ddd;
    }

    .labelCell {
        text-align: left;
        font-weight: bold;
        background: #f7f7f7;
        width: 250px;
    }

    .dropcell {
        min-height: 35px;
        background: #fafafa;
        cursor: pointer;
    }

    .dropcell:hover {
        background: #e6f7ff;
    }
</style>
</head>

<body>

<!-- Sidebar -->
<div id="sidebar">
    <h2>Dipendenti</h2>
    <div id="workersList"></div>

    <h3>Aggiungi dipendente</h3>
    <div id="addWorkerBox">
        <input type="text" id="newWorker" placeholder="Nome">
        <button onclick="addWorker()">+</button>
    </div>
</div>

<!-- Main -->
<div id="main">

    <h1>Programma Magazzino</h1>

    <!-- Navigazione settimana -->
    <div class="weekNav">
        <button onclick="prevWeek()">← Settimana precedente</button>
        <span id="weekLabel"></span>
        <button onclick="nextWeek()">Settimana successiva →</button>
    </div>

    <!-- ============================
         ESEMPIO DI REPARTO COMPLETO
         ============================ -->
    <div class="section">
        <h3>GRATTUGIATURA GRATTUGIA</h3>

        <table>
            <tr>
                <th>Reparto / Turno</th>
                <th>Lunedì</th>
                <th>Martedì</th>
                <th>Mercoledì</th>
                <th>Giovedì</th>
                <th>Venerdì</th>
                <th>Sabato</th>
            </tr>

            <!-- Sottoreparto -->
            <tr>
                <td class="labelCell">06:00–14:00</td>
                <td class="dropcell" data-key="g1_lun"></td>
                <td class="dropcell" data-key="g1_mar"></td>
                <td class="dropcell" data-key="g1_mer"></td>
                <td class="dropcell" data-key="g1_gio"></td>
                <td class="dropcell" data-key="g1_ven"></td>
                <td class="dropcell" data-key="g1_sab"></td>
            </tr>

            <!-- 5 righe operative -->
            <tr>
                <td class="labelCell"></td>
                <td class="dropcell" data-key="g2_lun"></td>
                <td class="dropcell" data-key="g2_mar"></td>
                <td class="dropcell" data-key="g2_mer"></td>
                <td class="dropcell" data-key="g2_gio"></td>
                <td class="dropcell" data-key="g2_ven"></td>
                <td class="dropcell" data-key="g2_sab"></td>
            </tr>

            <tr>
                <td class="labelCell"></td>
                <td class="dropcell" data-key="g3_lun"></td>
                <td class="dropcell" data-key="g3_mar"></td>
                <td class="dropcell" data-key="g3_mer"></td>
                <td class="dropcell" data-key="g3_gio"></td>
                <td class="dropcell" data-key="g3_ven"></td>
                <td class="dropcell" data-key="g3_sab"></td>
            </tr>

            <tr>
                <td class="labelCell"></td>
                <td class="dropcell" data-key="g4_lun"></td>
                <td class="dropcell" data-key="g4_mar"></td>
                <td class="dropcell" data-key="g4_mer"></td>
                <td class="dropcell" data-key="g4_gio"></td>
                <td class="dropcell" data-key="g4_ven"></td>
                <td class="dropcell" data-key="g4_sab"></td>
            </tr>

            <tr>
                <td class="labelCell"></td>
                <td class="dropcell" data-key="g5_lun"></td>
                <td class="dropcell" data-key="g5_mar"></td>
                <td class="dropcell" data-key="g5_mer"></td>
                <td class="dropcell" data-key="g5_gio"></td>
                <td class="dropcell" data-key="g5_ven"></td>
                <td class="dropcell" data-key="g5_sab"></td>
            </tr>
        </table>
    </div>

</div>

<script>
/* ============================================================
   GESTIONE SETTIMANE
   ============================================================ */
let currentWeek = getCurrentWeek();

function getCurrentWeek() {
    const now = new Date();
    const onejan = new Date(now.getFullYear(), 0, 1);
    return Math.ceil((((now - onejan) / 86400000) + onejan.getDay() + 1) / 7);
}

function updateWeekLabel() {
    document.getElementById("weekLabel").innerText =
        "Settimana " + currentWeek;
}

function prevWeek() {
    currentWeek--;
    loadTable();
    updateWorkersList();
    updateWeekLabel();
}

function nextWeek() {
    currentWeek++;
    loadTable();
    updateWorkersList();
    updateWeekLabel();
}

updateWeekLabel();

/* ============================================================
   DRAG & DROP
   ============================================================ */
function allowDrop(ev) { ev.preventDefault(); }
function drag(ev) { ev.dataTransfer.setData("text", ev.target.innerText); }

document.querySelectorAll(".dropcell").forEach(cell => {
    cell.ondragover = allowDrop;
    cell.ondrop = function(ev) {
        ev.preventDefault();
        const name = ev.dataTransfer.getData("text");
        this.innerText = name;
        saveTable();
        updateWorkersList();
    };
});

/* ============================================================
   SALVATAGGIO CELLE
   ============================================================ */
function saveTable() {
    document.querySelectorAll(".dropcell").forEach(cell => {
        const key = cell.dataset.key;
        const storageKey = `${currentWeek}_${key}`;
        localStorage.setItem(storageKey, cell.innerText);
    });
}

function loadTable() {
    document.querySelectorAll(".dropcell").forEach(cell => {
        const key = cell.dataset.key;
        const storageKey = `${currentWeek}_${key}`;
        cell.innerText = localStorage.getItem(storageKey) || "";
    });
}

loadTable();

/* ============================================================
   DIPENDENTI
   ============================================================ */
const defaultWorkers = [
"ILIE","ARCURI","BAGHIN","LINENCO","NOCENTINI","SOTTILI","BAGIARDI","CHAND","NANNUCCI",
"BROGELLI","PELLEGRINI","MARCUCCI","DI STEFANO","RENZI","BILLI","FAGIOLI","MAGHERINI",
"GRIMALDI","PALMIERI","HRICTU","DONATI","HRISTAR","MAGNI","SACCHETTI","PINHEIRO",
"TRIVIGNO","VINCI","RICCI","RIGHESCHI","PARDEEP","FORTE","CAPPELLI","ERMINI",
"PIPPUCCI","TOZZI","BRUNORI","CECCHERINI","COLONNA","NOTTURNI","NOVELLI"
];

function updateWorkersList() {
    const list = document.getElementById("workersList");
    list.innerHTML = "";

    const assigned = new Set();
    document.querySelectorAll(".dropcell").forEach(cell => {
        if (cell.innerText.trim() !== "") assigned.add(cell.innerText.trim());
    });

    defaultWorkers.forEach(w => {
        if (!assigned.has(w)) {
            const div = document.createElement("div");
            div.className = "worker";
            div.draggable = true;
            div.ondragstart = drag;
            div.innerText = w;
            list.appendChild(div);
        }
    });
}

updateWorkersList();

/* ============================================================
   AGGIUNTA DIPENDENTE
   ============================================================ */
function addWorker() {
    const name = document.getElementById("newWorker").value.trim();
    if (name === "") return;

    defaultWorkers.push(name);
    document.getElementById("newWorker").value = "";
    updateWorkersList();
}
</script>

</body>
</html>
